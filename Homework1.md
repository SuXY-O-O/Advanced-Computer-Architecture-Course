# 作业1：指令集体系结构与折衷

**苏星熠 ZY2206148**

## 1.  比较五种不同风格的指令集代码序列的内存效率

- a. 将下边的高级语言片段翻译成前述 5 种结构适用的代码序列。一定要确保将 A、B、D 的值存回内存，但是不能修改内存中任何其它的数值。

  ```
  A = B + C;
  B = A + C;
  D = A - B;
  ```

  + 零地址指令

    ```
    PUSH B;
    PUSH C;
    ADD;
    POP A;
    PUSH A;
    PUSH B;
    ADD;
    POP B;
    PUSH A;
    PUSH B;
    SUB;
    POP D;
    ```

    

  + 单地址指令

    ```
    LOAD B;
    ADD C;
    STORE A;
    ADD C;
    STORE B;
    LOAD A;
    SUB B;
    STORE D;
    ```

    

  + 双地址指令

    ```
    ADD B C;
    STORE B A;	//虽然题目没有给出存储转移操作，但这种操作是必要的，使用此条指令将内存B中当前值存储到内存A中
    ADD B C;	//A、B当前存储值相等，如此操作可以顺势存储期望的值到B中
    STORE A D;
    SUB D B;
    ```

    

  + 三地址指令——内存

    ```
    ADD A B C;
    ADD B A C;
    SUB D A B;
    ```

    

  + 三地址指令——寄存器

    ```
    LD R1 B;
    LD R2 C;
    ADD R1 R1 R2;
    ST R1 A;
    ADD R2 R1 R2;
    ST R2 B;
    SUB R1 R1 R2;
    ST R1 D;
    ```

- 请计算这 5 种结构对应的指令序列在执行时的取指令字节数和内存数据访问（读和写）字节数。

  C代表指令长度；R代表读取字节数；W代表写入字节数。

  - 零地址指令

    每个PUSH或POP对应一次内存读取与写入；

    每个ADD或SUB对应两次内存读取与一次内存写入。
    $$
    C_0 = 12 \times L_{op} + 8 \times L_{mem} = 28 bytes \newline
    R_0 = 15 \times L_{data} = 60 bytes \newline
    W_0 = 12 \times L_{data} = 48 bytes
    $$

  - 单地址指令

    每个LOAD对应一次内存读取；

    每个STORE对应一次内存写入；

    每个ADD或SUB对应一次内存读取；
    $$
    C_1 = 8 \times L_{op} + 8 \times L_{mem} = 24 bytes \newline
    R_1 = 5 \times L_{data} = 20 bytes \newline
    W_1 = 3 \times L_{data} = 12 bytes
    $$

  - 双地址指令

    每个ADD或SUB对应两次内存读取和一次内存写入；

    每个STORE对应一次内存读取与写入；
    $$
    C_2 = 5 \times L_{op} + 10 \times L_{mem} = 25 bytes \newline
    R_2 = 8 \times L_{data} = 32 bytes \newline
    W_2 = 5 \times L_{data} = 20 bytes
    $$

  - 三地址指令——内存

    每个ADD或SUB对应两次内存读取与一次内存写入；
    $$
    C_{31} = 3 \times L_{op} + 9 \times L_{mem} = 21 bytes \newline
    R_{31} = 6 \times L_{data} = 24 bytes \newline
    W_{31} = 3 \times L_{data} = 12 bytes
    $$

  - 三地址指令——寄存器

    每个LD对应一次内存读取；

    每个ST对应一次内存写入；
    $$
    C_{32} = 8 \times L_{op} + 14 \times L_{reg} + 5 \times L_{mem} = 32 bytes \newline
    R_{32} = 2 * L_{data} = 8 bytes \newline
    W_{32} = 3 * L_{data} = 12 bytes
    $$

- 从代码尺寸的角度哪一种结构最高效? 

  无论是代码长度还是存储代码空间大小，都是使用内存地址的三地址指令最好。

- 从内存总带宽的需求（代码+数据）角度哪一种结构最高效? 

  整体而言，使用寄存器的三地址指令最高效。

## 2. 固定长度和可变长度 ISA
```
ADD r3, r1, r2 // r3 = r1+r2
SLL r3, 0x2 // r3 = r3 << 2
MOV r5, 0xa // r5 = 0x0a
STW r3, (r5) // MEMORY[r5] = r3 
```

- 对以上两种 ISA，这段汇编代码的尺寸（字节数）分别是多少？

  + 对于固定长度，每个指令都需要三个操作数加1一个操作码，共4bytes，因而一共需要16bytes；

  + 对于可变长度，第一条指令4bytes，第二、三、四条指令3bytes，共13bytes。

- 对以上两种 ISA，执行这一段代码序列分别需要多少时钟周期？

  + 对于固定长度，前三条指令需要1个时钟周期，第四条需要4个时钟周期，执行共7个时钟周期；

  + 对于可变长度，前三条指令需要3个时钟周期，第四条需要6个时钟周期，执行共15个时钟周期。

- 哪种 ISA 的代码尺寸更小？为什么？

  可变长度的ISA代码尺寸更小，其可以选择性省略第三个操作数，从而可以节省占用的空间。

- 哪种 ISA 的执行时间更短？为什么？

  固定长度的ISA执行时间更短，因为其解码不需要判断本条指令的操作数个数，使得译码时间更短，进而缩短了执行时间。

## 3. 可寻址性 

假如我们有 64MB 的内存，请计算要获得以下寻址能力所需地址的长度：

- 位寻址

  共需要$64 \times 1024 \times 1024 \times 8 = 2^{29}$个地址，因此需要地址长度为29bit；

- 字节寻址

  共需要$64 \times 1024 \times 1024= 2^{26}$个地址，因此需要地址长度为26bit；

- 8字节寻址

  共需要$64 \times 1024 \times 1024 \div 8 = 2^{23}$个地址，因此需要地址长度为23bit；

- 32字节寻址

  共需要$64 \times 1024 \times 1024 \div 32 = 2^{21}$个地址，因此需要地址长度为21bit；

## 4. 微体系结构与ISA

- 简要叙述微体系结构和 ISA 之间的区别。编译器需要知道微体系结构的什么信息才能正确的编译程序？

  ISA是指令集体系结构，微体系结构是处理器的硬件架构。ISA用于规约微体系结构应当实现的操作，其规定了指令的解析方式、指令执行效果等，而微体系结构则应设计为可以实现ISA指令的方式。一种ISA可以对应多种不同的微体系结构，不同的微体系结构会造成相同ISA的执行效率不同。

  编译器需要知道微体系结构对ISA的实现情况，例如是否支持ISA中所有的指令及其扩展，以及其他硬件强相关的信息，例如内存地址限制、是否开启延迟槽等。如需优化，还需要知道微体系结构对ISA中各指令的执行效率以及其硬件实现时加入的特殊优化。

- 判别一台机器的以下性质是微体系结构的属性还是 ISA 的属性: 

  - 这台机器没有减法指令：ISA
  - 这台机器的 ALU 没有减法单元：微体系结构
  - 这台机器没有状态码：ISA
  - 在加法指令中可以指明一个 5 位的立即数：ISA
  - 执行一条加法指令需要 n 个时钟周期：微体系结构
  - 有 8 个通用寄存器：ISA
  - ALU 的一个输入需要一个 2 选 1 多路选择器：微体系结构
  - 寄存器堆有 1 个输入端口和 2 个输出端口：微体系结构

## 5. 性能指标

- 如果在具有更高主频的处理器上运行给定程序，是否意味着相比主频较低的处理器而言它总是能够在单位时间（比如 1 秒钟）内执行更多的指令？

  对于架构完全相同的处理器，提高主频确实可以认为其能够在单位时间内执行更多的指令；但是相同的程序在不同的ISA、不同的微体系结构上运行效率本身不尽相同，因此在不加更多条件（变量）限制情况下，题设错误。

- 如果一个处理器执行给定程序时每秒钟能够执行更多的指令，是否意味着相比每秒执行较少指令的处理器而言它总是能够更快地执行完这个程序。

  不同ISA或不同微体系结构下，相同程序执行需要的指令条数是不同的，因此题设错误。

## 6. 性能评价

ISA A的处理性能：$10IPC \times 500MHz = 5000MIPS$

ISA B的处理性能：$2IPC \times 600MHz = 1200MIPS$

两个处理器性能无法比较，因为相同程序在不同ISA上翻译后需要运行的指令条数相差很多，单纯从上述数据无法比较两个处理器性能。

## 7. 研究论文摘要

