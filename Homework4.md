# 作业3

## 1. 分支预测

### （a）当使用 last-time 预测器时三个分支的预测准确率分别是多少？

- 分支1：共执行1000次，其中末次会预测为发生，预测错误，总体准确率99.9%
- 分支2：共发生1000次，每4次中，实际运行状态为：不跳转、跳转、跳转、跳转，实际预测为：跳转、不跳转、跳转、跳转，发生两次错误。总体正确率50%
- 分支3：共发生1000次，每2次中，实际运行状态为：不跳转、跳转；实际预测为：跳转、不跳转。总体正确率0%

### （b）当使用基于 2-bit 饱和计数器的预测器时三个分支的预测准确率分别是多少？

- 分支1：仍然只有最后一次预测错误，正确率99.9%；

- 分支2：

  - | 实际 | 发生     | 不发生   | 不发生   | 不发生   | 发生     | 不发生   | 不发生   | 不发生   | 发生     | 不发生   | 不发生   | 不发生   |
    | ---- | -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- |
    | 预测 | 强不发生 | 弱不发生 | 强不发生 | 强不发生 | 强不发生 | 弱不发生 | 强不发生 | 强不发生 | 强不发生 | 弱不发生 | 强不发生 | 强不发生 |

  - 每4次错1次，准确率75%

- 分支3：

  - | 实际 | 发生     | 不发生   | 发生     | 不发生   | 发生     | 不发生   |
    | ---- | -------- | -------- | -------- | -------- | -------- | -------- |
    | 预测 | 强不发生 | 弱不发生 | 强不发生 | 弱不发生 | 强不发生 | 弱不发生 |

  - 每两次中错误1次，准确率50%

### （c）当分支 2 和分支 3 的 2-bit 计数器起始状态分别是 (i)‘弱不发生’

- 分支2：

  - | 实际 | 发生     | 不发生 | 不发生   | 不发生   | 发生     | 不发生   | 不发生   | 不发生   | 发生     | 不发生   | 不发生   | 不发生   |
    | ---- | -------- | ------ | -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- |
    | 预测 | 弱不发生 | 弱发生 | 弱不发生 | 强不发生 | 强不发生 | 弱不发生 | 强不发生 | 强不发生 | 强不发生 | 弱不发生 | 强不发生 | 强不发生 |

  - 前4次错了2次，后面每4次错1次，准确率74.9%

- 分支3：

  - | 实际 | 发生     | 不发生 | 发生     | 不发生 | 发生     | 不发生 |
    | ---- | -------- | ------ | -------- | ------ | -------- | ------ |
    | 预测 | 弱不发生 | 弱发生 | 弱不发生 | 弱发生 | 弱不发生 | 弱发生 |

  - 每次都错误，准确率0%

### （c）当分支 2 和分支 3 的 2-bit 计数器起始状态分别是 (ii)‘弱发生’

- 分支2：

  - | 实际 | 发生   | 不发生 | 不发生 | 不发生   | 发生     | 不发生   | 不发生   | 不发生   | 发生     | 不发生   | 不发生   | 不发生   |
    | ---- | ------ | ------ | ------ | -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- |
    | 预测 | 弱发生 | 强发生 | 弱发生 | 弱不发生 | 强不发生 | 弱不发生 | 强不发生 | 强不发生 | 强不发生 | 弱不发生 | 强不发生 | 强不发生 |

  - 前4次错了2次，后面每4次错1次，准确率74.9%

- 分支3：

  - | 实际 | 发生   | 不发生 | 发生   | 不发生 | 发生   | 不发生 |
    | ---- | ------ | ------ | ------ | ------ | ------ | ------ |
    | 预测 | 弱发生 | 强发生 | 弱发生 | 强发生 | 弱发生 | 强发生 |

  - 每2次错1次，准确率50%

### （d）当使用两层全局历史分支预测器（2bit 全局历史寄存器+每分支一张独立的模式历史表，模式历史表的每个表项是一个 2-bit 饱和计数器）时，三个分支的预测准确率分别是多少？假设全局历史寄存器每一位的初始状态都是‘不发生’，模式历史表中的 2-bit 饱和计数器初始状态都是‘强不发生’，计算预测准确率时，忽略前 500 次循环迭代。

- GHR中以（00）111-100-101-100循环

- 分支1变化：

  - | 全局状态 | 模式变化                                  |
    | -------- | ----------------------------------------- |
    | 00       | 强不发生-弱不发生-弱发生-强发生-强发生-…… |
    | 01       | 强不发生-弱不发生-弱发生-强发生-强发生-…… |
    | 10       | 强不发生-弱不发生-弱发生-强发生-强发生-…… |
    | 11       | 强不发生-弱不发生-弱发生-强发生-强发生-…… |

  - 最终都会变成强发生。后500次中只有最后1次预测错误，准确率99.8%

- 分支2变化：

  - | 全局状态 | 模式变化                                   |
    | -------- | ------------------------------------------ |
    | 00       | 强不发生（不变）                           |
    | 01       | 强不发生-弱不发生-（强不发生-弱不发生）-…… |
    | 10       | 强不发生（不变）                           |
    | 11       | 强不发生-强不发生-（强不发生）-……          |

  - 都预测为不发生，准确率75%

- 分支1变化：

  - | 全局状态 | 模式变化                                                     |
    | -------- | ------------------------------------------------------------ |
    | 00       | 强不发生（不变）                                             |
    | 01       | 强不发生（不变）                                             |
    | 10       | 强不发生-强不发生-弱不发生-强不发生-（强不发生-弱不发生-强不发生）-…… |
    | 11       | 强不发生-弱不发生-弱发生-强发生-（强发生）-……                |

  - 500次以后，每4次预测中，第1、2、4次预测成功，第3次预测失败，总体准确率75%

## 2. 两层分支预测器





