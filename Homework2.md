# 作业 2： 单周期 vs.多周期微体系结构

## 1. MIPS 单周期微体系结构分析

### 1.1 

- (a) `AND`指令使用了以下路径：

  - 指令寄存器、加法器、多选器；530ps。
  - 指令寄存器、控制、寄存器堆、多选器、ALU、多选器；880ps。

  因此关键路径为第二条。

- (b) `LW`指令关键路径：

  - 指令寄存器、控制、寄存器堆、多选器、ALU、数据存储器；1200ps。

- (c) `BEQ`指令关键路径：

  - 指令寄存器、控制、寄存器堆、多选器、ALU、多选器；880ps。

### 1.2

- (a) 还能使用的单元有（不改变指令长度情况下）：PC、指令寄存器、加法器、数据存储器、其中部分多路选择器。
- (b) 需要增加的功能单元有：
  - ALU：扩展输入数据个数，或增加ALU个数。
  - 寄存器堆：扩展输入地址线个数以及输出数据线个数，允许同时读取并输出3个寄存器的值。
  - 控制单元：新增加控制信号。
  - 多路选择器，选择输入ALU的数据来源；选择输入寄存器堆的写地址来源。
- (c) 新增信号包括
  - 扩展ALU为3输入时：增加输入数据选择信号。
  - 增加ALU单元时：增加第二ALU是否启用信号。
  - 增加寄存器堆写地址来源的选择信号。
- (d) (e) (f)
  - a. 更快的加法器
    - 改进前：
      - 根据1.1(b)，改进前时钟周期应至少为1200ps;
      - 价格计算为：$1000 + 200 + 500 + 100 + 2000 + 2\times30 + 3\times10=3890$
    - 改进后：
      - 加速比为1，因为加法器不在关键路径上。
      - 价格计算为$3890 + 2\times20 = 3930$；价格提升同时性能不变。
  - b. 更大的寄存器堆
    - 改进前：同上
    - 改进后：
      - 时钟周期至少为1300ps
      - 价格为$3890 + 200 = 4090$；变为原来的$4090 / 3890 = 1.05$倍
      - 加速比为$(1 \times 1200)/(0.95\times1300)=0.97$
      - 价格提升但性能下降了。

### 1.3

- (a) 仅支持ALU类指令时，时钟周期为$500 + 220 + 100 + 180 + 100 + 220 = 1320ps$
- (b) 仅支持lw类指令，需要$500 + 220 + 100 + 180 + 1000 = 2000ps$
- (c) 需要2000ps，满足最大值即可。
- (d) $(1000 / 2000) \times (20\% + 10\%) = 0.15$
- (e) $(90 / 2000)\times 15\% = 0.00675$；其他时间参与计算，但计算结果被多路选择器舍弃。
- (f) 应当减少数据存储器的。改善后周期变为1900，加速比为1.05。

### 1.4

- (a) 留给MemWrite信号的时间有$220 + 100 + 180 = 500ps$

- (b) 最不关键的是Jump信号，允许时间有$220 + 100 + 180 + 1000 + 100 + 220 = 1820ps$

- (c) 最关键信号为ALUSrc信号，允许时间为$220ps$

- (d) 时钟周期为$500 + 1500(MemWrite) + 1000 + 100 + 220 = 3320ps$

- (e) 加速MemWrite，因为其在关键路径上。最小代价当然是不加速，不加速就不花钱。

- (f) 可以尝试减慢所有不在关键路径上的信号。

  | RegDst  |  Jump   | Branch  | MemRead | MemToReg |  ALUOp  | ALUSrc  | RegWrite |
  | :-----: | :-----: | :-----: | :-----: | :------: | :-----: | :-----: | :------: |
  | +1400ps | +1620ps | +1720ps | +1500ps |  +600ps  | +1365ps | +1320ps | +1400ps  |

## 2.  MIPS 多周期微体系结构分析

### 2.1 

- (a) 读取Data的指令会失效，MemtoReg固定为0时会限制寄存器堆只能写入ALUOut。
- (b) 部分ALU运算会失效，ALUOp信号有两位，最多有4种变化，其中一位固定为0时会导致ALUOp有一半信号错误。
- (c) jr等需要读取寄存器值进行跳转的指令不能正常运行。

### 2.2

一共要运行

- addi：6次 * 4周期 = 24周期
- beq：6次 * 3周期 = 18周期
- j：5次 * 3周期 = 15周期

共57周期；

CPI = 57 / (6 + 6 + 5) = 3.35



